# Copyright (c) Mondoo, Inc.
# SPDX-License-Identifier: BUSL-1.1

packs:
  - uid: mondoo-openssl-incident-response
    name: OpenSSL Incident Response Pack
    version: 1.1.0
    license: BUSL-1.1
    authors:
      - name: Mondoo, Inc
        email: hello@mondoo.com
    tags:
      mondoo.com/platform: linux
      mondoo.com/category: security
    docs:
      desc: |
        ### Overview

        The OpenSSL Incident Response Pack retrieves SSL/TLS library information from Linux hosts for investigation during a security incident. This includes platform details, installed SSL libraries, and listening ports that may be using SSL/TLS.

        ### Run query pack

        To run this query pack locally on a Linux host:

        ```bash
        cnquery scan local -f mondoo-openssl-incident-response.mql.yaml
        ```

        To run against a remote Linux host using SSH:

        ```bash
        cnquery scan ssh <user>@<ip_address> -f mondoo-openssl-incident-response.mql.yaml
        ```
    filters:
      - asset.family.contains("linux")
    queries:
      - uid: mondoo-openssl-incident-response-platform
        title: Platform details
        docs:
          desc: Retrieves the operating system platform, version, and architecture to identify the affected system.
        mql: |
          asset {
            platform
            version
            arch
          }
      - uid: mondoo-openssl-incident-response-installed-version
        title: Installed ssl libraries
        docs:
          desc: Lists all installed packages with 'ssl' in their name to identify OpenSSL and related library versions that may be affected by vulnerabilities.
        mql: packages.where(name == /ssl/)
      - uid: mondoo-openssl-incident-response-listening-ports
        title: Listening ports for running systems
        docs:
          desc: Lists all listening network ports to identify services that may be using SSL/TLS and could be affected by OpenSSL vulnerabilities.
        mql: |
          if ( mondoo.capabilities.contains('run-command') ) {
            ports.listening {
              protocol
              address
              port
            }
          }
