# Copyright (c) Mondoo, Inc.
# SPDX-License-Identifier: BUSL-1.1

packs:
  - uid: mondoo-linux-incident-response
    name: Linux Incident Response Pack
    version: 1.2.0
    license: BUSL-1.1
    authors:
      - name: Mondoo, Inc
        email: hello@mondoo.com
    tags:
      mondoo.com/platform: linux
      mondoo.com/category: security
    docs:
      desc: |
        ### Overview

        The Linux Incident Response Pack by Mondoo retrieves configuration data from Linux hosts for investigation during a security incident. This includes kernel information, running processes, mounted devices, listening ports, installed packages, and running services.

        ### Run query pack

        To run this query pack locally on a Linux host:

        ```bash
        cnquery scan local -f mondoo-linux-incident-response.mql.yaml
        ```

        To run against a remote Linux host using SSH:

        ```bash
        cnquery scan ssh <user>@<ip_address> -f mondoo-linux-incident-response.mql.yaml
        ```
    filters:
      - asset.family.contains("linux")
    queries:
      - uid: mondoo-linux-incident-response-installed-kernel
        title: Installed kernels
        docs:
          desc: Lists all installed kernel versions to identify available kernels and verify if security patches have been applied.
        filters: mondoo.capabilities.contains("run-command")
        mql: kernel.installed
      - uid: mondoo-linux-incident-response-kernel-info
        title: Running kernel version
        docs:
          desc: Returns information about the currently running kernel to identify the active kernel version and potential vulnerabilities.
        filters: mondoo.capabilities.contains("run-command")
        mql: kernel.info
      - uid: mondoo-linux-incident-response-kernel-modules
        title: Kernel modules
        docs:
          desc: Lists all kernel modules with their load status to identify potentially malicious or unauthorized kernel extensions.
        mql: kernel.modules { name loaded }
      - uid: mondoo-linux-incident-response-processes
        title: Running processes
        docs:
          desc: Lists all running processes with their PID and command to identify suspicious or malicious processes.
        filters: mondoo.capabilities.contains("run-command")
        mql: processes { pid  command }
      - uid: mondoo-linux-incident-response-mounts
        title: Mounted devices
        docs:
          desc: Lists all mounted filesystems with their paths, types, devices, and mount options to identify unusual mounts or insecure configurations.
        mql: mount.list { path fstype device options }
      - uid: mondoo-linux-incident-response-listening-ports
        title: Listening ports
        docs:
          desc: Lists all listening network ports to identify services exposed to the network and potential unauthorized access points.
        filters: mondoo.capabilities.contains("run-command")
        mql: ports.listening
      - uid: mondoo-linux-incident-response-uptime
        title: Operating system uptime
        docs:
          desc: Returns the system uptime to help determine when the system was last rebooted and establish incident timeline.
        filters: mondoo.capabilities.contains("run-command")
        mql: os.uptime
      - uid: mondoo-linux-incident-response-installed-packages
        title: Installed packages
        docs:
          desc: Lists all installed packages with version, architecture, and origin information to identify potentially vulnerable or malicious software.
        mql: packages { name version arch installed epoch origin purl }
      - uid: mondoo-linux-incident-response-running-services
        title: Running services
        docs:
          desc: Lists all currently running services with their status to identify suspicious or unauthorized services that may indicate compromise.
        mql: services.where(running == true) { name running enabled masked type }
