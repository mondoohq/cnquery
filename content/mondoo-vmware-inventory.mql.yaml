# Copyright (c) Mondoo, Inc.
# SPDX-License-Identifier: BUSL-1.1

packs:
  - uid: mondoo-vmware-asset-inventory
    name: VMware Asset Inventory Pack
    version: 1.1.0
    license: BUSL-1.1
    authors:
      - name: Mondoo, Inc
        email: hello@mondoo.com
    tags:
      mondoo.com/platform: vmware,vmware-esxi
      mondoo.com/category: security
    docs:
      desc: |
        ## Overview

        VMware vCenter Asset Inventory Pack by Mondoo retrieves data about vCenter and its ESXi hosts.

        ### Run query pack

        To run this query pack against VMware vCenter:

        ```bash
        cnquery scan vsphere user@domain.local@192.168.5.24 --ask-pass -f core/mondoo-vmware-inventory.mql.yaml
        ```

        ## Join the community!

        Our goal is to build policies that are simple to deploy, accurate, and actionable.

        If you have any suggestions for improving this policy, or if you need support, [join the Mondoo community](https://github.com/orgs/mondoohq/discussions) in GitHub Discussions.
    filters: asset.platform == "vmware-esxi" || asset.platform == "vmware-vsphere"
    queries:
      - uid: mondoo-vmware-asset-inventory-vcenter-datacenters
        title: VMware vSphere Datacenters
        docs:
          desc: Lists all vSphere datacenters in the environment.
        filters: asset.platform == "vmware-vsphere"
        mql: |
          vsphere.datacenters { name }
      - uid: mondoo-vmware-asset-inventory-vcenter-clusters
        title: VMware vSphere Clusters per Datacenter
        docs:
          desc: Lists all vSphere clusters within each datacenter.
        filters: asset.platform == "vmware-vsphere"
        mql: |
          vsphere.datacenters { clusters }
      - uid: mondoo-vmware-asset-inventory-vcenter-vms
        title: VMware vSphere VMs per Datacenters
        docs:
          desc: Lists all virtual machines in each datacenter with their guest OS state and detailed guest info.
        filters: asset.platform == "vmware-vsphere"
        mql: |
          vsphere.datacenters { vms { name advancedSettings["guestInfo.detailed.data"] properties["guest"]["guestState"] } }
      - uid: mondoo-vmware-asset-inventory-esxi-kernel-modules
        title: VMware ESXi Kernel modules
        docs:
          desc: Lists all kernel modules loaded on the ESXi host.
        filters: asset.platform == "vmware-esxi"
        mql: |
          vsphere.host.kernelModules
      - uid: mondoo-vmware-asset-inventory-esxi-installed-packages
        title: VMware ESXi Installed packages
        docs:
          desc: Lists all VIBs (vSphere Installation Bundles) installed on the ESXi host.
        filters: asset.platform == "vmware-esxi"
        mql: |
          vsphere.host.packages
      - uid: mondoo-vmware-asset-inventory-esxi-services
        title: VMware ESXi Services
        docs:
          desc: Lists all services configured on the ESXi host with their status.
        filters: asset.platform == "vmware-esxi"
        mql: |
          vsphere.host.services
      - uid: mondoo-vmware-asset-inventory-esxi-acceptance-level
        title: VMware ESXi Acceptance Level
        docs:
          desc: Returns the host acceptance level that determines which VIBs can be installed.
        filters: asset.platform == "vmware-esxi"
        mql: |
          vsphere.host.acceptanceLevel
      - uid: mondoo-vmware-asset-inventory-esxi-ntp-server
        title: VMware ESXi NTP servers
        docs:
          desc: Lists configured NTP servers for time synchronization.
        filters: asset.platform == "vmware-esxi"
        mql: |
          vsphere.host.ntp.server
      - uid: mondoo-vmware-asset-inventory-esxi-ntp-config
        title: VMware ESXi NTP configuration
        docs:
          desc: Returns the NTP client configuration settings.
        filters: asset.platform == "vmware-esxi"
        mql: |
          vsphere.host.ntp.config
      - uid: mondoo-vmware-asset-inventory-esxi-fileSystemVolume
        title: VMware ESXi File System Volume
        docs:
          desc: Returns configured file system volume.
        filters: asset.platform == "vmware-esxi"
        mql: |
          vsphere.host.properties.config.fileSystemVolume
      - uid: mondoo-vmware-asset-inventory-esxi-firewall
        title: VMware ESXi Firewall
        docs:
          desc: Returns the ESXi firewall configuration and rules.
        filters: asset.platform == "vmware-esxi"
        mql: |
          vsphere.host.properties.config.firewall
      - uid: mondoo-vmware-asset-inventory-esxi-adapters
        title: VMware ESXi Physical Adapters
        docs:
          desc: Lists physical network adapters installed in the ESXi host.
        filters: asset.platform == "vmware-esxi"
        mql: |
          vsphere.host.adapters
      - uid: mondoo-vmware-asset-inventory-esxi-standardSwitch
        title: VMware ESXi Standard vSwitch
        docs:
          desc: Lists standard virtual switches configured on the ESXi host.
        filters: asset.platform == "vmware-esxi"
        mql: |
          vsphere.host.standardSwitch

