# Copyright (c) Mondoo, Inc.
# SPDX-License-Identifier: BUSL-1.1

packs:
  - uid: mondoo-incident-response-github-org
    name: GitHub Organization Incident Response Pack
    version: 1.1.0
    license: BUSL-1.1
    authors:
      - name: Mondoo, Inc
        email: hello@mondoo.com
    tags:
      mondoo.com/platform: github,saas
      mondoo.com/category: security
    docs:
      desc: |
        ### Overview

        The GitHub Organization Incident Response Pack retrieves configuration data about GitHub organizations and repositories for investigation during a security incident.

        ### Prerequisites

        To run this query pack, you will need a [GitHub personal access token](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token) with read access to the GitHub organization you are scanning.

        ### Run query pack

        To run this query pack against a GitHub Organization:

        ```bash
        export GITHUB_TOKEN=<your personal access token>
        cnquery scan github org <org_name> -f mondoo-github-org-incident-response.mql.yaml
        ```
    filters:
      - asset.platform == "github-org"
    queries:
      - uid: mondoo-incident-response-github-org-name
        title: GitHub Organization Name
        docs:
          desc: |
            Returns the display name of the GitHub organization.
        mql: |
          github.organization.name
      - uid: mondoo-incident-response-github-org-login
        title: GitHub Organization Login
        docs:
          desc: |
            Returns the login handle (URL slug) of the GitHub organization.
        mql: |
          github.organization.login
      - uid: mondoo-incident-response-github-org-description
        title: GitHub Organization description
        docs:
          desc: |
            Returns the description configured for the GitHub organization.
        mql: |
          github.organization.description
      - uid: mondoo-incident-response-github-org-mfa-status
        title: GitHub Organization MFA status
        docs:
          desc: |
            Returns whether multi-factor authentication is required for organization users. A null value indicates insufficient API token permissions; owner permissions are required.
        mql: |
          github.organization.twoFactorRequirementEnabled
      - uid: mondoo-incident-response-github-org-owners
        title: GitHub Organization Owners
        docs:
          desc: |
            Retrieves all GitHub organization owners.
        mql: |
          github.organization.owners.length
          github.organization {
            owners {
              name
              email
              login
            }
          }
      - uid: mondoo-incident-response-github-org-members
        title: GitHub Organization Members
        docs:
          desc: |
            Retrieves all members of the GitHub organization.
        mql: |
          github.organization.members.length
          github.organization {
            members {
              name
              login
              email
            }
          }
      - uid: mondoo-incident-response-github-org-teams
        title: GitHub Organization Teams
        docs:
          desc: |
            Retrieves all GitHub organization teams with their members and permissions.
        mql: |
          github.organization {
            teams {
              slug
              privacy
              defaultPermission
              members {
                login
                email
                name
              }
            }
          }
      - uid: mondoo-incident-response-github-private-repos
        title: GitHub Organization public repositories
        docs:
          desc: |
            Retrieves all public repositories in the organization with branch protection status.
        mql: |
          github.organization.repositories.
            where( private == false ) {
              name
              branches.
                where( isDefault ) {
                  isProtected
                }
            }
      - uid: mondoo-incident-response-github-packages
        title: GitHub Organization packages
        docs:
          desc: |
            Retrieves packages published to GitHub Container Registry (GHCR).
        mql: |
          github.organization {
            packages {
              name
              visibility
              packageType
              owner {
                name
              }
            }
          }
