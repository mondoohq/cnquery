// Copyright (c) Mondoo, Inc.
// SPDX-License-Identifier: BUSL-1.1

// Code generated by resources. DO NOT EDIT.

package resources

import (
	"errors"

	"go.mondoo.com/cnquery/v11/llx"
	"go.mondoo.com/cnquery/v11/providers-sdk/v1/plugin"
	"go.mondoo.com/cnquery/v11/types"
)

var resourceFactories map[string]plugin.ResourceFactory

func init() {
	resourceFactories = map[string]plugin.ResourceFactory {
		"mondoo.agent": {
			// to override args, implement: initMondooAgent(runtime *plugin.Runtime, args map[string]*llx.RawData) (map[string]*llx.RawData, plugin.Resource, error)
			Create: createMondooAgent,
		},
		"mondoo.space": {
			// to override args, implement: initMondooSpace(runtime *plugin.Runtime, args map[string]*llx.RawData) (map[string]*llx.RawData, plugin.Resource, error)
			Create: createMondooSpace,
		},
		"mondoo.asset": {
			// to override args, implement: initMondooAsset(runtime *plugin.Runtime, args map[string]*llx.RawData) (map[string]*llx.RawData, plugin.Resource, error)
			Create: createMondooAsset,
		},
		"mondoo.resource": {
			// to override args, implement: initMondooResource(runtime *plugin.Runtime, args map[string]*llx.RawData) (map[string]*llx.RawData, plugin.Resource, error)
			Create: createMondooResource,
		},
	}
}

// NewResource is used by the runtime of this plugin to create new resources.
// Its arguments may be provided by users. This function is generally not
// used by initializing resources from recordings or from lists.
func NewResource(runtime *plugin.Runtime, name string, args map[string]*llx.RawData) (plugin.Resource, error) {
	f, ok := resourceFactories[name]
	if !ok {
		return nil, errors.New("cannot find resource " + name + " in this provider")
	}

	if f.Init != nil {
		cargs, res, err := f.Init(runtime, args)
		if err != nil {
			return res, err
		}

		if res != nil {
			id := name+"\x00"+res.MqlID()
			if x, ok := runtime.Resources.Get(id); ok {
				return x, nil
			}
			runtime.Resources.Set(id, res)
			return res, nil
		}

		args = cargs
	}

	res, err := f.Create(runtime, args)
	if err != nil {
		return nil, err
	}

	id := name+"\x00"+res.MqlID()
	if x, ok := runtime.Resources.Get(id); ok {
		return x, nil
	}

	runtime.Resources.Set(id, res)
	return res, nil
}

// CreateResource is used by the runtime of this plugin to create resources.
// Its arguments must be complete and pre-processed. This method is used
// for initializing resources from recordings or from lists.
func CreateResource(runtime *plugin.Runtime, name string, args map[string]*llx.RawData) (plugin.Resource, error) {
	f, ok := resourceFactories[name]
	if !ok {
		return nil, errors.New("cannot find resource " + name + " in this provider")
	}

	res, err := f.Create(runtime, args)
	if err != nil {
		return nil, err
	}

	id := name+"\x00"+res.MqlID()
	if x, ok := runtime.Resources.Get(id); ok {
		return x, nil
	}

	runtime.Resources.Set(id, res)
	return res, nil
}

var getDataFields = map[string]func(r plugin.Resource) *plugin.DataRes{
	"mondoo.agent.mrn": func(r plugin.Resource) *plugin.DataRes {
		return (r.(*mqlMondooAgent).GetMrn()).ToDataRes(types.String)
	},
	"mondoo.space.name": func(r plugin.Resource) *plugin.DataRes {
		return (r.(*mqlMondooSpace).GetName()).ToDataRes(types.String)
	},
	"mondoo.space.mrn": func(r plugin.Resource) *plugin.DataRes {
		return (r.(*mqlMondooSpace).GetMrn()).ToDataRes(types.String)
	},
	"mondoo.space.assets": func(r plugin.Resource) *plugin.DataRes {
		return (r.(*mqlMondooSpace).GetAssets()).ToDataRes(types.Array(types.Resource("mondoo.asset")))
	},
	"mondoo.asset.name": func(r plugin.Resource) *plugin.DataRes {
		return (r.(*mqlMondooAsset).GetName()).ToDataRes(types.String)
	},
	"mondoo.asset.mrn": func(r plugin.Resource) *plugin.DataRes {
		return (r.(*mqlMondooAsset).GetMrn()).ToDataRes(types.String)
	},
	"mondoo.asset.platform": func(r plugin.Resource) *plugin.DataRes {
		return (r.(*mqlMondooAsset).GetPlatform()).ToDataRes(types.String)
	},
	"mondoo.asset.resources": func(r plugin.Resource) *plugin.DataRes {
		return (r.(*mqlMondooAsset).GetResources()).ToDataRes(types.Array(types.Resource("mondoo.resource")))
	},
	"mondoo.resource.name": func(r plugin.Resource) *plugin.DataRes {
		return (r.(*mqlMondooResource).GetName()).ToDataRes(types.String)
	},
	"mondoo.resource.id": func(r plugin.Resource) *plugin.DataRes {
		return (r.(*mqlMondooResource).GetId()).ToDataRes(types.String)
	},
}

func GetData(resource plugin.Resource, field string, args map[string]*llx.RawData) *plugin.DataRes {
	f, ok := getDataFields[resource.MqlName()+"."+field]
	if !ok {
		return &plugin.DataRes{Error: "cannot find '" + field + "' in resource '" + resource.MqlName() + "'"}
	}

	return f(resource)
}

var setDataFields = map[string]func(r plugin.Resource, v *llx.RawData) bool {
	"mondoo.agent.__id": func(r plugin.Resource, v *llx.RawData) (ok bool) {
			r.(*mqlMondooAgent).__id, ok = v.Value.(string)
			return
		},
	"mondoo.agent.mrn": func(r plugin.Resource, v *llx.RawData) (ok bool) {
		r.(*mqlMondooAgent).Mrn, ok = plugin.RawToTValue[string](v.Value, v.Error)
		return
	},
	"mondoo.space.__id": func(r plugin.Resource, v *llx.RawData) (ok bool) {
			r.(*mqlMondooSpace).__id, ok = v.Value.(string)
			return
		},
	"mondoo.space.name": func(r plugin.Resource, v *llx.RawData) (ok bool) {
		r.(*mqlMondooSpace).Name, ok = plugin.RawToTValue[string](v.Value, v.Error)
		return
	},
	"mondoo.space.mrn": func(r plugin.Resource, v *llx.RawData) (ok bool) {
		r.(*mqlMondooSpace).Mrn, ok = plugin.RawToTValue[string](v.Value, v.Error)
		return
	},
	"mondoo.space.assets": func(r plugin.Resource, v *llx.RawData) (ok bool) {
		r.(*mqlMondooSpace).Assets, ok = plugin.RawToTValue[[]interface{}](v.Value, v.Error)
		return
	},
	"mondoo.asset.__id": func(r plugin.Resource, v *llx.RawData) (ok bool) {
			r.(*mqlMondooAsset).__id, ok = v.Value.(string)
			return
		},
	"mondoo.asset.name": func(r plugin.Resource, v *llx.RawData) (ok bool) {
		r.(*mqlMondooAsset).Name, ok = plugin.RawToTValue[string](v.Value, v.Error)
		return
	},
	"mondoo.asset.mrn": func(r plugin.Resource, v *llx.RawData) (ok bool) {
		r.(*mqlMondooAsset).Mrn, ok = plugin.RawToTValue[string](v.Value, v.Error)
		return
	},
	"mondoo.asset.platform": func(r plugin.Resource, v *llx.RawData) (ok bool) {
		r.(*mqlMondooAsset).Platform, ok = plugin.RawToTValue[string](v.Value, v.Error)
		return
	},
	"mondoo.asset.resources": func(r plugin.Resource, v *llx.RawData) (ok bool) {
		r.(*mqlMondooAsset).Resources, ok = plugin.RawToTValue[[]interface{}](v.Value, v.Error)
		return
	},
	"mondoo.resource.__id": func(r plugin.Resource, v *llx.RawData) (ok bool) {
			r.(*mqlMondooResource).__id, ok = v.Value.(string)
			return
		},
	"mondoo.resource.name": func(r plugin.Resource, v *llx.RawData) (ok bool) {
		r.(*mqlMondooResource).Name, ok = plugin.RawToTValue[string](v.Value, v.Error)
		return
	},
	"mondoo.resource.id": func(r plugin.Resource, v *llx.RawData) (ok bool) {
		r.(*mqlMondooResource).Id, ok = plugin.RawToTValue[string](v.Value, v.Error)
		return
	},
}

func SetData(resource plugin.Resource, field string, val *llx.RawData) error {
	f, ok := setDataFields[resource.MqlName() + "." + field]
	if !ok {
		return errors.New("[mondoo] cannot set '"+field+"' in resource '"+resource.MqlName()+"', field not found")
	}

	if ok := f(resource, val); !ok {
		return errors.New("[mondoo] cannot set '"+field+"' in resource '"+resource.MqlName()+"', type does not match")
	}
	return nil
}

func SetAllData(resource plugin.Resource, args map[string]*llx.RawData) error {
	var err error
	for k, v := range args {
		if err = SetData(resource, k, v); err != nil {
			return err
		}
	}
	return nil
}

// mqlMondooAgent for the mondoo.agent resource
type mqlMondooAgent struct {
	MqlRuntime *plugin.Runtime
	__id string
	// optional: if you define mqlMondooAgentInternal it will be used here
	Mrn plugin.TValue[string]
}

// createMondooAgent creates a new instance of this resource
func createMondooAgent(runtime *plugin.Runtime, args map[string]*llx.RawData) (plugin.Resource, error) {
	res := &mqlMondooAgent{
		MqlRuntime: runtime,
	}

	err := SetAllData(res, args)
	if err != nil {
		return res, err
	}

	// to override __id implement: id() (string, error)

	if runtime.HasRecording {
		args, err = runtime.ResourceFromRecording("mondoo.agent", res.__id)
		if err != nil || args == nil {
			return res, err
		}
		return res, SetAllData(res, args)
	}

	return res, nil
}

func (c *mqlMondooAgent) MqlName() string {
	return "mondoo.agent"
}

func (c *mqlMondooAgent) MqlID() string {
	return c.__id
}

func (c *mqlMondooAgent) GetMrn() *plugin.TValue[string] {
	return &c.Mrn
}

// mqlMondooSpace for the mondoo.space resource
type mqlMondooSpace struct {
	MqlRuntime *plugin.Runtime
	__id string
	// optional: if you define mqlMondooSpaceInternal it will be used here
	Name plugin.TValue[string]
	Mrn plugin.TValue[string]
	Assets plugin.TValue[[]interface{}]
}

// createMondooSpace creates a new instance of this resource
func createMondooSpace(runtime *plugin.Runtime, args map[string]*llx.RawData) (plugin.Resource, error) {
	res := &mqlMondooSpace{
		MqlRuntime: runtime,
	}

	err := SetAllData(res, args)
	if err != nil {
		return res, err
	}

	// to override __id implement: id() (string, error)

	if runtime.HasRecording {
		args, err = runtime.ResourceFromRecording("mondoo.space", res.__id)
		if err != nil || args == nil {
			return res, err
		}
		return res, SetAllData(res, args)
	}

	return res, nil
}

func (c *mqlMondooSpace) MqlName() string {
	return "mondoo.space"
}

func (c *mqlMondooSpace) MqlID() string {
	return c.__id
}

func (c *mqlMondooSpace) GetName() *plugin.TValue[string] {
	return &c.Name
}

func (c *mqlMondooSpace) GetMrn() *plugin.TValue[string] {
	return &c.Mrn
}

func (c *mqlMondooSpace) GetAssets() *plugin.TValue[[]interface{}] {
	return plugin.GetOrCompute[[]interface{}](&c.Assets, func() ([]interface{}, error) {
		if c.MqlRuntime.HasRecording {
			d, err := c.MqlRuntime.FieldResourceFromRecording("mondoo.space", c.__id, "assets")
			if err != nil {
				return nil, err
			}
			if d != nil {
				return d.Value.([]interface{}), nil
			}
		}

		return c.assets()
	})
}

// mqlMondooAsset for the mondoo.asset resource
type mqlMondooAsset struct {
	MqlRuntime *plugin.Runtime
	__id string
	// optional: if you define mqlMondooAssetInternal it will be used here
	Name plugin.TValue[string]
	Mrn plugin.TValue[string]
	Platform plugin.TValue[string]
	Resources plugin.TValue[[]interface{}]
}

// createMondooAsset creates a new instance of this resource
func createMondooAsset(runtime *plugin.Runtime, args map[string]*llx.RawData) (plugin.Resource, error) {
	res := &mqlMondooAsset{
		MqlRuntime: runtime,
	}

	err := SetAllData(res, args)
	if err != nil {
		return res, err
	}

	if res.__id == "" {
	res.__id, err = res.id()
		if err != nil {
			return nil, err
		}
	}

	if runtime.HasRecording {
		args, err = runtime.ResourceFromRecording("mondoo.asset", res.__id)
		if err != nil || args == nil {
			return res, err
		}
		return res, SetAllData(res, args)
	}

	return res, nil
}

func (c *mqlMondooAsset) MqlName() string {
	return "mondoo.asset"
}

func (c *mqlMondooAsset) MqlID() string {
	return c.__id
}

func (c *mqlMondooAsset) GetName() *plugin.TValue[string] {
	return &c.Name
}

func (c *mqlMondooAsset) GetMrn() *plugin.TValue[string] {
	return &c.Mrn
}

func (c *mqlMondooAsset) GetPlatform() *plugin.TValue[string] {
	return &c.Platform
}

func (c *mqlMondooAsset) GetResources() *plugin.TValue[[]interface{}] {
	return plugin.GetOrCompute[[]interface{}](&c.Resources, func() ([]interface{}, error) {
		if c.MqlRuntime.HasRecording {
			d, err := c.MqlRuntime.FieldResourceFromRecording("mondoo.asset", c.__id, "resources")
			if err != nil {
				return nil, err
			}
			if d != nil {
				return d.Value.([]interface{}), nil
			}
		}

		return c.resources()
	})
}

// mqlMondooResource for the mondoo.resource resource
type mqlMondooResource struct {
	MqlRuntime *plugin.Runtime
	__id string
	// optional: if you define mqlMondooResourceInternal it will be used here
	Name plugin.TValue[string]
	Id plugin.TValue[string]
}

// createMondooResource creates a new instance of this resource
func createMondooResource(runtime *plugin.Runtime, args map[string]*llx.RawData) (plugin.Resource, error) {
	res := &mqlMondooResource{
		MqlRuntime: runtime,
	}

	err := SetAllData(res, args)
	if err != nil {
		return res, err
	}

	if res.__id == "" {
	res.__id, err = res.id()
		if err != nil {
			return nil, err
		}
	}

	if runtime.HasRecording {
		args, err = runtime.ResourceFromRecording("mondoo.resource", res.__id)
		if err != nil || args == nil {
			return res, err
		}
		return res, SetAllData(res, args)
	}

	return res, nil
}

func (c *mqlMondooResource) MqlName() string {
	return "mondoo.resource"
}

func (c *mqlMondooResource) MqlID() string {
	return c.__id
}

func (c *mqlMondooResource) GetName() *plugin.TValue[string] {
	return &c.Name
}

func (c *mqlMondooResource) GetId() *plugin.TValue[string] {
	return &c.Id
}
