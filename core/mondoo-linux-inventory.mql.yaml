packs:
  - uid: mondoo-linux-inventory
    name: Linux Inventory Pack
    version: 1.2.0
    authors:
      - name: Mondoo, Inc
        email: hello@mondoo.com
    tags:
      mondoo.com/platform: linux,host
      mondoo.com/category: best-practices
    docs:
      desc: |
        The Linux Inventory Pack by Mondoo retrieves data about Linux hosts for asset inventory. 

        ## Local scan
        To run this pack locally on a Linux host:

        ```bash
        cnquery scan local -f mondoo-linux-inventory.mql.yaml
        ```

        ## Remote scan
        To run this pack against a remote Linux host using SSH:

        ```bash
        cnquery scan ssh <user>@<ip_address> -i <identity_file> -f mondoo-linux-inventory.mql.yaml
        ```

        ## Join the community!
        Our goal is to build query packs that are simple to deploy and provide accurate and useful data. 
        
        If you have any suggestions for improving this query pack, or if you need support, [join the Mondoo community](https://github.com/orgs/mondoohq/discussions) in GitHub Discussions. 
    filters:
      - asset.family.contains("linux")
    queries:
      - uid: mondoo-linux-asset-info
        title: Retrieve asset information
        mql: asset { kind title platform name arch runtime }
      - uid: mondoo-linux-hostname
        title: Retrieve the hostname
        mql: os.hostname
      - uid: mondoo-linux-platform
        title: Retrieve the platform
        mql: platform.name
      - uid: mondoo-linux-users 
        title: Retrieve regular users with shell access 
        mql: users.where( shell != "/sbin/nologin" && uid >= 1000 && name != "root")
      - uid: mondoo-linux-groups-wheel
        title: Retrieve members of the wheel group
        mql: groups.where( name == "wheel") { members }
      - uid: mondoo-linux-installed-kernel
        title: Retrieve installed Linux kernels
        mql: |
          if ( mondoo.capabilities.contains('run-command') ) {
            kernel.installed
          }
      - uid: mondoo-linux-kernel-info
        title: Retrieve the running Linux kernel
        mql: |
          if ( mondoo.capabilities.contains('run-command') ) {
            kernel.info
          }
      - uid: mondoo-linux-kernel-modules
        title: Retrieve Linux kernel modules
        mql: kernel.modules { name loaded }
      - uid: mondoo-linux-processes
        title: Retrieve running processes
        mql: |
          if ( mondoo.capabilities.contains('run-command') ) {
            processes { pid  command }
          }
      - uid: mondoo-linux-mounts
        title: Retrieve  mounted devices
        mql: mount.list
      - uid: mondoo-linux-listening-ports
        title: Retrieve all listening ports
        mql: |
          if ( mondoo.capabilities.contains('run-command') ) {
            ports.listening
          }
      - uid: mondoo-linux-uptime
        title: Retrieve operating system uptime
        mql: |
          if ( mondoo.capabilities.contains('run-command') ) {
            os.uptime
          }
      - uid: mondoo-linux-installed-packages
        title: Retrieve installed packages
        mql: packages
      - uid: mondoo-linux-running-services
        title: Retrieve running services
        mql: services.where( running == true )
      - uid: mondoo-linux-interface-configuration
        title: Retrieve interface configuration of the system
        mql: |
          if ( mondoo.capabilities.contains('run-command') ) {
            parse.json(content: command('ip -j a').stdout).params
          }
      - uid: mondoo-sshd-interface-configuration
        title: Retrieve sshd configuration of the system
        mql: |
          if ( package('openssh-server').installed || package('openssh').installed ) {
            sshd.config.params
          }
      - uid: mondoo-linux-system-manufacturer
        title: Retrieve the system manufacturer
        mql: |
          machine.baseboard.manufacturer
      - uid: mondoo-linux-system-product-name
        title: Retrieve the system product name
        mql: |
          machine.baseboard.product
      - uid: mondoo-linux-cpu-type
        title: Retrieve the type of CPU
        mql: |
          command('cat /proc/cpuinfo | grep "model name" | sort -u | cut -d : -f 2-').stdout.trim
      - uid: mondoo-linux-root-volume
        title: Retrieve the size and filesystem type of the root volume
        mql: |
          command("df -TH / | grep '/dev' | awk '{ print $3 "+'" "'+" $2 }'").stdout.trim
      - uid: mondoo-linux-physical-memory
        title: Retrieve the amount of physical memory
        mql: |
          command("free --mega | grep Mem | awk '{ print $2}'").stdout.trim + "M"