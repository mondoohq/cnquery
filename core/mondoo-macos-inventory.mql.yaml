packs:
  - uid: mondoo-macos-inventory
    name: macOS Inventory Pack
    version: 1.0.0
    authors:
      - name: Mondoo, Inc
        email: hello@mondoo.com
    tags:
      mondoo.com/platform: macos,host
      mondoo.com/category: best-practices
    docs:
      desc: |
        The macOS Inventory Pack by Mondoo retrieves data about macOS hosts for asset inventory. 

        ## Local scan
        To run this pack locally on a macOS host:

        ```bash
        cnquery scan local -f mondoo-macos-inventory.mql.yaml
        ```

        ## Remote scan
        To run this pack against a remote macOS host using SSH (requires Remote Management is activated in System Preferences):

        ```bash
        cnquery scan ssh <user>@<ip_address> -i <identity_file> -f mondoo-macos-inventory.mql.yaml
        ```

        ## Join the community!
        Our goal is to build query packs that are simple to deploy and provide accurate and useful data. 
        
        If you have any suggestions for improving this query pack, or if you need support, [join the Mondoo community](https://github.com/orgs/mondoohq/discussions) in GitHub Discussions. 
    filters:
      - asset.platform.contains("macos")
    queries:
      - uid: mondoo-macos-machine-model-identifier
        title: Retrieve the machine model identifer
        mql: |
          parse.json(content: command('system_profiler SPHardwareDataType -json').stdout).params['SPHardwareDataType'].first['machine_model']
      - uid: mondoo-macos-machine-model-name
        title: Retrieve the machine model name
        mql: |
          parse.json(content: command('system_profiler SPHardwareDataType -json').stdout).params['SPHardwareDataType'].first['machine_name']
      - uid: mondoo-macos-model-part-number
        title: Retrieve the model part number
        mql: |
          parse.json(content: command('system_profiler SPHardwareDataType -json').stdout).params['SPHardwareDataType'].first['model_number']
      - uid: mondoo-macos-serial-number
        title: Retrieve the system serial number
        mql: |
          parse.json(content: command('system_profiler SPHardwareDataType -json').stdout).params['SPHardwareDataType'].first['serial_number']
      - uid: mondoo-macos-cpu-type
        title: Retrieve the type of CPU
        mql: |
          parse.json(content: command('system_profiler SPHardwareDataType -json').stdout).params['SPHardwareDataType'].first['chip_type']
      - uid: mondoo-macos-physical-memory
        title: Retrieve the amount of physical memory
        mql: |
          parse.json(content: command('system_profiler SPHardwareDataType -json').stdout).params['SPHardwareDataType'].first['physical_memory']
      - uid: mondoo-asset-info
        title: Retrieve asset information
        mql: asset { kind title platform name arch runtime version }
      - uid: mondoo-hostname
        title: Retrieve the hostname
        mql: os.hostname
      - uid: mondoo-macos-users 
        title: Retrieve regular users 
        mql: users.where( name != /^_/ && shell != "/usr/bin/false" && name != "root")
      - uid: mondoo-macos-packages
        title: Retrieve macOS packages 
        mql: packages
      - uid: mondoo-macos-running-services
        title: Retrieve data on running services
        mql: services.where( running == true )
      - uid: mondoo-macos-ports-listening
        title: Retrieve data on listening ports 
        mql: ports.listening 
      - uid: mondoo-macos-interface-configuration
        title: Retrieve interface configuration of the system
        mql: command("ifconfig").stdout